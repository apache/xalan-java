<!--
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
-->

Copyright 1999-2022 The Apache Software Foundation

Authors:
   Gary Gregory <ggregory@apache.org>
   Mukul Gandhi <mukulg@apache.org>

This file primarily, contains instructions to the person(s) who shall be making an Apache XalanJ 
release for distribution, along with the instructions about how to test XalanJ release before 
recommending the release for distribution.

The details mentioned within this file, may also be used, by XalanJ source distribution users to 
build and test XalanJ from the source distribution (except that, "git clone" steps as mentioned 
within this file, might not be required to be run by XalanJ source distribution users).

(1) Steps to build the XalanJ release

1) Do a git clone, of the relevant XalanJ branches:

git clone --single-branch https://gitbox.apache.org/repos/asf/xalan-java.git -b xalan-j_2_7_1_maint

git clone https://gitbox.apache.org/repos/asf/xalan-test.git

This creates two folders: xalan-java and xalan-test

2) Set JAVA_HOME and ANT_HOME environment variables, for example:

set JAVA_HOME=C:\Program Files\Eclipse Adoptium\jdk-8.0.352.8-hotspot\

set ANT_HOME=C:\java\apache-ant-1.10.12

3) Run the command, "build clean fulldist" from folder xalan-java. This shall produce the following jars, 
relevant for testing the XalanJ build : xalan.jar, serializer.jar. [1]

(2) Steps to run the XalanJ tests, on XalanJ implementation

1) Go to the XalanJ tests repos's, local git clone folder:
cd ..\xalan-test

For XalanJ source distribution users, xalan-test folder, is located at the root of the XalanJ 
source distribution folder (i.e, parallel to folders "src", "tools" etc) from where XalanJ 
source distribution users may run XalanJ tests.

2) Set JAVA_HOME and ANT_HOME environment variables, for example:

set JAVA_HOME=C:\Program Files\Eclipse Adoptium\jdk-8.0.352.8-hotspot\

set ANT_HOME=C:\java\apache-ant-1.10.12

3) Run the command "build clean jar" from folder xalan-test. This produces
the file testxsl.jar within folder xalan-test/java/build.

4) Create a folder xalanjrelease_jardir somewhere on file system.
Copy the jar file testxsl.jar produced within the previous step, to the folder 
xalanjrelease_jardir. Copy the jars xalan.jar, serializer.jar [1] to this 
folder. From the folder xalan-java/lib/endorsed, copy jars xml-apis.jar and 
xercesImpl.jar to the folder xalanjrelease_jardir. Copy the jar Tidy.jar from folder 
xalan-test/tools to the folder xalanjrelease_jardir. From the folder xalan-java/lib 
copy the jars bsf.jar, rhino-1.7.14.jar, commons-logging-1.2.jar, regexp.jar to the 
folder xalanjrelease_jardir (XalanJ source distribution users may copy the jars bsf.jar, 
rhino-1.7.14.jar, commons-logging-1.2.jar, regexp.jar from folder for e.g xalan-j_2_7_3/lib 
within the source distribution).

Now the folder xalanjrelease_jardir, has the XalanJ jar xalan.jar that needs 
to be tested, and all the supporting jars needed for testing.

For example, on Windows, from xalan-test:

copy /Y java\build\testxsl.jar "%JARDIR%"
copy /Y tools\Tidy.jar "%JARDIR%"

copy /Y ..\xalan-java\build\xalan.jar "%JARDIR%"
copy /Y ..\xalan-java\build\serializer.jar "%JARDIR%"
copy /Y ..\xalan-java\lib\bsf.jar "%JARDIR%"
copy /Y ..\xalan-java\lib\commons-logging-1.2.jar "%JARDIR%"
copy /Y ..\xalan-java\lib\regexp.jar "%JARDIR%"
copy /Y ..\xalan-java\lib\rhino-1.7.14.jar "%JARDIR%"
copy /Y ..\xalan-java\lib\endorsed\xercesImpl.jar "%JARDIR%"
copy /Y ..\xalan-java\lib\endorsed\xml-apis.jar "%JARDIR%"

5) Set JARDIR environment variable, pointing to the folder "xalanjrelease_jardir".

6) Run the necessary XalanJ tests as follows,

The tests described below within points 5.1, 5.2 and 5.3 need to be run from folder xalan-test. 

6.1 Run the ant target "smoketest", using following two commands in sequence shown below

build extensions

build smoketest

The output of the command "build smoketest" should be following, and without any other build errors,

smoketest-pass:
     [echo]  [minitest] CONGRATULATIONS! The Smoketest passed!

6.2 Run the ant target "smoketest.xsltc", using following three commands in sequence shown below 

build conf.xsltc

build accept.xsltc

build smoketest.xsltc

The output of the command "build smoketest.xsltc" should be following, and without any other build errors,

smoketest.xsltc-pass:
     [echo]  [minitest] CONGRATULATIONS! The Smoketest passed!

6.3 Run the ant target "smoketest.dev", using following two commands in sequence shown below

build extensions

build smoketest.dev

The output of the command "build smoketest.dev" should be following, and without any other build errors,

smoketest-pass:
     [echo]  [minitest] CONGRATULATIONS! The Smoketest passed!
     
6.4 From folder xalan-test/tests/xsltc_integer_truncation, run the batch file 
xsltc_int_truncation_test.bat (provided for Windows platform) to run test for, 
"XalanJ integer truncation bug fix, when using XSLTC".    
     